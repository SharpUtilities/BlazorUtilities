@* SessionState.Examples/Components/Pages/BasicUsage.razor *@
@page "/basic-usage"
@using SessionState.Core
@using SessionState.Examples.SessionStates
@implements IDisposable

<PageTitle>Basic Usage - SessionState</PageTitle>

<h1>Basic Usage</h1>
<p class="lead">Demonstrates simple get, set, and clear operations with SessionState.</p>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Counter State</h5>
            </div>
            <div class="card-body">
                @if (Counter.HasValue)
                {
                    <div class="d-flex align-items-center gap-3 mb-3">
                        <button class="btn btn-outline-secondary" @onclick="DecrementCounter">-</button>
                        <span class="fs-1 fw-bold">@Counter.Value!.Count</span>
                        <button class="btn btn-outline-secondary" @onclick="IncrementCounter">+</button>
                    </div>
                    <p class="text-muted small">Last updated: @Counter.Value.LastUpdated.ToString("HH:mm:ss")</p>

                    <div class="btn-group">
                        <button class="btn btn-warning" @onclick="ResetCounter">Reset</button>
                        <button class="btn btn-danger" @onclick="ClearCounter">Clear State</button>
                    </div>
                }
                else
                {
                    <p class="text-muted">No counter state exists yet.</p>
                    <button class="btn btn-primary" @onclick="InitializeCounter">Initialize Counter</button>
                }
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>State Info</h5>
            </div>
            <div class="card-body">
                <dl>
                    <dt>Has Value</dt>
                    <dd><code>@Counter.HasValue</code></dd>

                    <dt>Current Value</dt>
                    <dd><code>@(Counter.Value?.Count.ToString() ?? "null")</code></dd>
                </dl>

                <div class="alert alert-secondary">
                    <strong>Note:</strong> This counter persists across page refreshes and works
                    across HTTP and SignalR contexts.
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <h4>Code Example</h4>
    <pre class="bg-dark text-light p-3 rounded"><code>@@inject SessionState&lt;CounterState&gt; Counter

// Check if state exists
if (Counter.HasValue)
{
    var count = Counter.Value!.Count;
}

// Set state (creates or updates)
await Counter.SetAsync(new CounterState { Count = 42 });

// Modify existing state
Counter.Value!.Count++;  // Auto-persists if TrackPropertyChanges is enabled

// Clear state
await Counter.ClearAsync();</code></pre>
</div>

@code {
    [Inject] private SessionState<CounterState> Counter { get; set; } = default!;

    protected override void OnInitialized()
    {
        Counter.Changed += OnCounterChanged;
    }

    private void OnCounterChanged(object? sender, SessionStateChangedEventArgs<CounterState> e)
    {
        InvokeAsync(StateHasChanged);
    }

    private async Task InitializeCounter()
    {
        await Counter.SetAsync(new CounterState { Count = 0 });
    }

    private void IncrementCounter()
    {
        Counter.Value?.Increment();
    }

    private void DecrementCounter()
    {
        Counter.Value?.Decrement();
    }

    private void ResetCounter()
    {
        Counter.Value?.Reset();
    }

    private async Task ClearCounter()
    {
        await Counter.ClearAsync();
    }

    public void Dispose()
    {
        Counter.Changed -= OnCounterChanged;
    }
}
